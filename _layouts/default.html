<!DOCTYPE html>
<head>
  {% include head.html %}
  <link rel="stylesheet" href="{{ '/assets/css/root-vars.css' | relative_url }}">
  <link rel="stylesheet" href="{{ '/assets/css/tokens-hybrid.css' | relative_url }}">
  <!-- Page-specific JS -->
  {% if page.url == "/portfolio/" %}
    <script src="{{ '/assets/js/portfolio.js' | relative_url }}"></script>
  {% endif %}
  <!-- Contact Schema -->
  {% if page.url == "/contact/" %}
    {% include contact-page.html %}
  {% endif %}
  <!-- Structured Data (HowTo/TechArticle) -->
  {% assign schema_kind = page.schema_type | default: "HowTo" %}
  {% if schema_kind == "HowTo" %}
    {% include schema-howto.html %}
  {% else %}
    {% include schema-techarticle.html %}
  {% endif %}
  <!-- FAQPage Structured Data -->
  {% if page.url == "/faq/" %}
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [
        {% assign faq_sections = site.data.faq %}
        {% for section in faq_sections %}
          {% for faq in section.items %}
            {
              "@type": "Question",
              "name": {{ faq.question | jsonify }},
              "acceptedAnswer": {
                "@type": "Answer",
                "text": {{ faq.answer | strip_html | jsonify }}
              }
            }{% unless forloop.last and forloop.parentloop.last %},{% endunless %}
          {% endfor %}
        {% endfor %}
      ]
    }
    </script>
  {% endif %}
  <!-- Success Page Confetti Script -->
  {% if page.permalink == "/success/" %}
    <script>
      (function () {
        const confettiRoot = document.getElementById("confetti");
        const partyBtn = document.getElementById("partyBtn");
        function burst(count) {
          if (!confettiRoot) return;
          confettiRoot.innerHTML = "";
          const reduce =
            window.matchMedia &&
            window.matchMedia("(prefers-reduced-motion: reduce)").matches;
          if (reduce) return;
          const colors = [
            "#0b6cff",
            "#10b981",
            "#f59e0b",
            "#ef4444",
            "#a855f7",
            "#14b8a6",
          ];
          for (let i = 0; i < count; i++) {
            const piece = document.createElement("i");
            const x = Math.floor(Math.random() * 100) + "vw";
            const dx = (Math.random() * 40 - 20).toFixed(1) + "vw";
            const r = Math.floor(Math.random() * 360) + "deg";
            const d = (Math.random() * 1.2 + 1.3).toFixed(2) + "s";
            piece.style.setProperty("--x", x);
            piece.style.setProperty("--dx", dx);
            piece.style.setProperty("--r", r);
            piece.style.setProperty("--d", d);
            piece.style.background =
              colors[Math.floor(Math.random() * colors.length)];
            if (Math.random() > 0.7) {
              piece.style.width = "12px";
              piece.style.height = "12px";
              piece.style.borderRadius = "999px";
            } else if (Math.random() > 0.7) {
              piece.style.height = "20px";
            }
            confettiRoot.appendChild(piece);
          }
          window.setTimeout(() => {
            confettiRoot.innerHTML = "";
          }, 3200);
        }
        window.setTimeout(() => burst(42), 180);
        if (partyBtn) partyBtn.addEventListener("click", () => burst(55));
      })();
    </script>
  {% endif %}

</head>
<body>
  {{ content }}
</body>
