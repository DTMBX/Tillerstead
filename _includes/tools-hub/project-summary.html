<!-- Project Summary Panel (Desktop Right Sidebar) -->
<div class="project-summary__inner">
  
  <!-- Header -->
  <div class="project-summary__header">
    <h2 class="project-summary__title" id="summary-project-name">Untitled Project</h2>
    <button class="project-summary__edit" aria-label="Edit project" onclick="editProjectName()">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
        <path d="M11.5 1.5l3 3L5 14H2v-3L11.5 1.5z"/>
      </svg>
    </button>
  </div>

  <!-- Stats Grid -->
  <div class="project-summary__stats">
    <div class="summary-stat">
      <span class="summary-stat__icon">üìè</span>
      <div class="summary-stat__content">
        <span class="summary-stat__label">Total Area</span>
        <span class="summary-stat__value" id="summary-area">0 sq ft</span>
      </div>
    </div>

    <div class="summary-stat">
      <span class="summary-stat__icon">üß±</span>
      <div class="summary-stat__content">
        <span class="summary-stat__label">Tiles Needed</span>
        <span class="summary-stat__value" id="summary-tiles">0</span>
      </div>
    </div>

    <div class="summary-stat">
      <span class="summary-stat__icon">üí∞</span>
      <div class="summary-stat__content">
        <span class="summary-stat__label">Est. Budget</span>
        <span class="summary-stat__value" id="summary-budget">$0</span>
      </div>
    </div>

    <div class="summary-stat">
      <span class="summary-stat__icon">üìÖ</span>
      <div class="summary-stat__content">
        <span class="summary-stat__label">Timeline</span>
        <span class="summary-stat__value" id="summary-timeline">0 days</span>
      </div>
    </div>
  </div>

  <!-- Progress -->
  <div class="project-summary__progress">
    <div class="progress-header">
      <span class="progress-header__label">Project Progress</span>
      <span class="progress-header__value" id="summary-progress-text">0%</span>
    </div>
    <div class="progress-bar">
      <div class="progress-bar__fill" id="summary-progress-bar" style="width: 0%"></div>
    </div>
    <p class="progress-hint" id="summary-progress-hint">Start by adding room dimensions</p>
  </div>

  <!-- Materials Summary (Collapsible) -->
  <details class="project-summary__materials" id="summary-materials">
    <summary class="materials-summary__header">
      <span>Materials List</span>
      <svg class="materials-summary__arrow" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
        <path d="M4 6l4 4 4-4"/>
      </svg>
    </summary>
    <div class="materials-summary__content">
      <ul class="materials-list" id="materials-list">
        <li class="materials-list__empty">No materials calculated yet</li>
      </ul>
    </div>
  </details>

  <!-- Quick Actions -->
  <div class="project-summary__actions">
    <button class="btn-primary btn-block" onclick="window.location.hash = '#/estimate'">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v8a2 2 0 01-2 2h-1l-4 4z"/>
      </svg>
      <span>Request Quote</span>
    </button>
    
    <button class="btn-secondary btn-block" onclick="window.location.hash = '#/export'">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M4 16v2a2 2 0 002 2h8a2 2 0 002-2v-2M8 10l4-4m0 0l4 4m-4-4v12"/>
      </svg>
      <span>Export PDF</span>
    </button>

    <button class="btn-outline btn-block" onclick="if(confirm('Reset project? This cannot be undone.')) window.ProjectState.reset(false)">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
      </svg>
      <span>Reset Project</span>
    </button>
  </div>

  <!-- Credentials Badge -->
  <div class="project-summary__badge">
    <div class="credentials-badge">
      <span class="credentials-badge__icon">‚úì</span>
      <div class="credentials-badge__content">
        <span class="credentials-badge__label">Licensed NJ Contractor</span>
        <span class="credentials-badge__value">HIC #13VH10808800</span>
      </div>
    </div>
  </div>

</div>

<script>
  // Update summary panel from ProjectState
  (function() {
    if (!window.ProjectState) return;
    
    function updateSummary() {
      const summary = window.ProjectState.getSummary();
      
      // Project name
      const nameEl = document.getElementById('summary-project-name');
      if (nameEl) nameEl.textContent = summary.projectName || 'Untitled Project';
      
      // Stats
      const areaEl = document.getElementById('summary-area');
      if (areaEl) areaEl.textContent = `${summary.totalArea || 0} sq ft`;
      
      const tilesEl = document.getElementById('summary-tiles');
      if (tilesEl) {
        const count = summary.tileCount || 0;
        const boxes = summary.boxesNeeded || 0;
        tilesEl.textContent = boxes ? `${count} (${boxes} boxes)` : count;
      }
      
      const budgetEl = document.getElementById('summary-budget');
      if (budgetEl) {
        const budget = summary.budgetEstimate || 0;
        budgetEl.textContent = budget ? `$${budget.toLocaleString()}` : '$0';
      }
      
      const timelineEl = document.getElementById('summary-timeline');
      if (timelineEl) {
        const days = summary.laborDays || 0;
        timelineEl.textContent = days ? `${days} days` : '0 days';
      }
      
      // Progress
      const percent = summary.completionPercent || 0;
      const progressBar = document.getElementById('summary-progress-bar');
      const progressText = document.getElementById('summary-progress-text');
      const progressHint = document.getElementById('summary-progress-hint');
      
      if (progressBar) progressBar.style.width = `${percent}%`;
      if (progressText) progressText.textContent = `${percent}%`;
      if (progressHint) {
        const hints = [
          'Start by adding room dimensions',
          'Choose your tile size and type',
          'Calculate materials needed',
          'Review labor estimate',
          'Almost there! Request a quote',
          'Project complete! Export or get quote'
        ];
        const hintIndex = Math.min(Math.floor(percent / 20), hints.length - 1);
        progressHint.textContent = hints[hintIndex];
      }
      
      // Materials list
      updateMaterialsList();
    }
    
    function updateMaterialsList() {
      const listEl = document.getElementById('materials-list');
      if (!listEl) return;
      
      const materials = [];
      const state = window.ProjectState.state;
      
      // Tile
      if (state.tile?.calculated?.tileCount) {
        materials.push({
          icon: 'üß±',
          name: 'Tile',
          quantity: state.tile.calculated.boxesNeeded || state.tile.calculated.tileCount,
          unit: state.tile.calculated.boxesNeeded ? 'boxes' : 'pieces'
        });
      }
      
      // Grout
      if (state.grout?.calculated?.bagsNeeded) {
        materials.push({
          icon: 'ü™£',
          name: 'Grout',
          quantity: state.grout.calculated.bagsNeeded,
          unit: 'bags'
        });
      }
      
      // Mortar
      if (state.mortar?.calculated?.bagsNeeded) {
        materials.push({
          icon: 'üîß',
          name: 'Thin-set Mortar',
          quantity: state.mortar.calculated.bagsNeeded,
          unit: 'bags'
        });
      }
      
      // Waterproofing
      if (state.waterproofing?.calculated?.gallons) {
        materials.push({
          icon: 'üíß',
          name: 'Waterproofing',
          quantity: state.waterproofing.calculated.gallons,
          unit: 'gallons'
        });
      }
      
      // Leveling
      if (state.leveling?.calculated?.bagsNeeded) {
        materials.push({
          icon: 'üìè',
          name: 'Self-Leveling',
          quantity: state.leveling.calculated.bagsNeeded,
          unit: 'bags'
        });
      }
      
      if (materials.length === 0) {
        listEl.innerHTML = '<li class="materials-list__empty">No materials calculated yet</li>';
      } else {
        listEl.innerHTML = materials.map(m => `
          <li class="materials-list__item">
            <span class="materials-list__icon">${m.icon}</span>
            <span class="materials-list__name">${m.name}</span>
            <span class="materials-list__quantity">${m.quantity} ${m.unit}</span>
          </li>
        `).join('');
      }
    }
    
    // Initial update
    updateSummary();
    
    // Listen for changes
    window.ProjectState.on('change', updateSummary);
    window.ProjectState.on('batch-update', updateSummary);
  })();
</script>
