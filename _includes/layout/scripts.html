{% comment %} JavaScript Assets - Core and feature-specific scripts Loads all
JavaScript modules with cache busting and proper defer/async attributes {%
endcomment %} {% assign cache_version = site.cache_version | default:
'2026-01-18.1' %}

<!-- Core JavaScript (ES Module) -->
<script
  type="module"
  src="{{ '/assets/js/main.js' | relative_url }}?v={{ cache_version }}"
></script>

<!-- Premium UX Enhancements -->
<script
  src="{{ '/assets/js/premium-ux.js' | relative_url }}?v={{ cache_version }}"
  defer
></script>

<!-- Premium Animation Engine (vanilla, performance-focused) -->
<script
  src="{{ '/assets/js/animation-engine.js' | relative_url }}?v={{ cache_version }}"
  defer
></script>

<!-- Feature-specific scripts -->
<script
  src="{{ '/assets/js/header-premium.js' | relative_url }}?v={{ cache_version }}"
  defer
></script>
<script
  src="{{ '/assets/js/lazy-loading.js' | relative_url }}?v={{ cache_version }}"
  defer
></script>
<script
  src="{{ '/assets/js/scroll-animations.js' | relative_url }}?v={{ cache_version }}"
  defer
></script>
<script
  src="{{ '/assets/js/micro-interactions.js' | relative_url }}?v={{ cache_version }}"
  defer
></script>

<!-- Contact form handler (loads on all pages, only activates on form) -->
<script
  src="{{ '/assets/js/contact-form-handler.js' | relative_url }}?v={{ cache_version }}"
  defer
></script>

<!-- Mobile App Features (PWA enhancements) -->
<script
  src="{{ '/assets/js/haptics.js' | relative_url }}?v={{ cache_version }}"
  defer
></script>
<script
  src="{{ '/assets/js/mobile-app.js' | relative_url }}?v={{ cache_version }}"
  defer
></script>
<script
  src="{{ '/assets/js/pwa-features.js' | relative_url }}?v={{ cache_version }}"
  defer
></script>
<script
  src="{{ '/assets/js/gestures.js' | relative_url }}?v={{ cache_version }}"
  defer
></script>
<script
  src="{{ '/assets/js/app-shell.js' | relative_url }}?v={{ cache_version }}"
  defer
></script>
<script
  src="{{ '/assets/js/mobile-personality.js' | relative_url }}?v={{ cache_version }}"
  defer
></script>

<!-- Build Phase Calculators (conditionally loaded) -->
{% if page.url contains '/build/' %}
<script
  src="{{ '/assets/js/build-calculators.js' | relative_url }}?v={{ cache_version }}"
  defer
></script>
{% endif %}

<!-- Legacy Tools (Estimate Builder + Export) -->
{% if page.url contains '/tools/legacy/' %}
<script
  src="{{ '/assets/js/tools.js' | relative_url }}?v={{ cache_version }}"
  defer
></script>
{% endif %}
<!-- Table of contents builder -->
<script>
(function () {
  const toc = document.querySelector('[data-toc]');
  if (!toc) return;

  const scopeSel = toc.getAttribute('data-toc-scope') || 'main';
  const scope = document.querySelector(scopeSel);
  if (!scope) return;

  const headings = scope.querySelectorAll('h2, h3');
  if (!headings.length) return;

  const ul = document.createElement('ul');
  ul.className = 'toc__list';

  headings.forEach(h => {
    if (!h.id) return;

    const li = document.createElement('li');
    li.className = 'toc__item level-' + h.tagName.replace('H','');

    const a = document.createElement('a');
    a.className = 'toc__link';
    a.href = '#' + h.id;
    a.textContent = h.textContent;

    li.appendChild(a);
    ul.appendChild(li);
  });

  toc.appendChild(ul);
})();
</script>
{% if jekyll.environment == 'development' %}
<!-- Development overlay for debugging -->
<script
  src="{{ '/assets/js/dev-overlay.js' | relative_url }}?v={{ cache_version }}"
  defer
></script>
{% endif %}

