{% assign nav = site.data.navigation %}
<header class="site-header ts-header ts-theme"
        role="banner"
        itemscope
        itemtype="https://schema.org/Organization"
        data-header>

  <!-- Organization microdata -->
  <meta itemprop="name" content="{{ site.title | escape }}">
  <meta itemprop="url" content="{{ site.url | default: site.github.url }}">
  <meta itemprop="logo" content="{{ '/assets/img/logo/tillerstead-logo-header.svg' | absolute_url }}">
  <meta itemprop="telephone" content="+1-609-862-8808">
  <meta itemprop="address" itemscope itemtype="https://schema.org/PostalAddress">
  <meta itemprop="addressLocality" content="New Jersey">

  <div class="site-header-inner">

    <!-- Left side navigation (first 3 items) -->
    <nav class="site-nav site-nav--left" role="navigation" aria-label="Primary navigation">
      <ul class="site-menu site-menu--left">
        {% for item in nav.primary limit:3 %}
          {% assign is_active = false %}
          {% if item.match and page.url %}
            {% if page.url matches item.match %}
              {% assign is_active = true %}
            {% endif %}
          {% endif %}

          <li class="nav-item{% if item.children %} has-children{% endif %}">
            {% if item.url %}
              <a href="{{ item.url | relative_url }}"
                 class="nav-link{% if is_active %} active{% endif %}"
                 {% if item.external %} target="_blank" rel="noopener"{% endif %}>
                {{ item.title }}
              </a>
            {% else %}
              <span class="nav-link nav-link--label">{{ item.title }}</span>
            {% endif %}

            {% if item.children %}
              <button class="nav-subtoggle"
                      type="button"
                      aria-label="Open {{ item.title }} menu"
                      aria-expanded="false"
                      data-subtoggle>
                <span aria-hidden="true">▾</span>
              </button>

              <ul class="nav-submenu" data-submenu>
                {% for child in item.children %}
                  {% assign child_active = false %}
                  {% if child.match and page.url %}
                    {% if page.url matches child.match %}
                      {% assign child_active = true %}
                    {% endif %}
                  {% endif %}
                  <li class="nav-subitem">
                    <a href="{{ child.url | relative_url }}"
                       class="nav-sublink{% if child_active %} active{% endif %}"
                       {% if child.external %} target="_blank" rel="noopener"{% endif %}>
                      {{ child.title }}
                    </a>
                  </li>
                {% endfor %}
              </ul>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    </nav>

    <!-- Center logo -->
    <div class="site-branding" data-logo>
      <a href="{{ '/' | relative_url }}" class="ts-logo-link" aria-label="{{ site.title | escape }} home">
        <img src="{{ '/assets/img/logo/tillerstead-logo-header-dark.svg' | relative_url }}"
             alt="{{ site.title | escape }}"
             class="ts-logo">
      </a>
    </div>

    <!-- Right side navigation (next 3 items, then overflow into More dropdown) -->
    <nav class="site-nav site-nav--right" role="navigation" aria-label="Secondary navigation">
      <ul class="site-menu site-menu--right">

        {% assign right_items = nav.primary offset:3 %}
        {% assign visible_right = right_items | slice: 0, 3 %}
        {% assign overflow_right = right_items | slice: 3, 50 %}

        {% for item in visible_right %}
          {% assign is_active = false %}
          {% if item.match and page.url %}
            {% if page.url matches item.match %}
              {% assign is_active = true %}
            {% endif %}
          {% endif %}

          <li class="nav-item{% if item.children %} has-children{% endif %}">
            {% if item.url %}
              <a href="{{ item.url | relative_url }}"
                 class="nav-link{% if is_active %} active{% endif %}"
                 {% if item.external %} target="_blank" rel="noopener"{% endif %}>
                {{ item.title }}
              </a>
            {% else %}
              <span class="nav-link nav-link--label">{{ item.title }}</span>
            {% endif %}

            {% if item.children %}
              <button class="nav-subtoggle"
                      type="button"
                      aria-label="Open {{ item.title }} menu"
                      aria-expanded="false"
                      data-subtoggle>
                <span aria-hidden="true">▾</span>
              </button>

              <ul class="nav-submenu" data-submenu>
                {% for child in item.children %}
                  <li class="nav-subitem">
                    <a href="{{ child.url | relative_url }}"
                       class="nav-sublink"
                       {% if child.external %} target="_blank" rel="noopener"{% endif %}>
                      {{ child.title }}
                    </a>
                  </li>
                {% endfor %}
              </ul>
            {% endif %}
          </li>
        {% endfor %}

        {% if overflow_right and overflow_right.size > 0 %}
          <li class="nav-item has-children nav-item--more">
            <button class="nav-link nav-link--button"
                    type="button"
                    aria-label="Open more menu"
                    aria-expanded="false"
                    data-subtoggle>
              More <span aria-hidden="true">▾</span>
            </button>
            <ul class="nav-submenu" data-submenu>
              {% for item in overflow_right %}
                <li class="nav-subitem">
                  <a href="{{ item.url | relative_url }}"
                     class="nav-sublink"
                     {% if item.external %} target="_blank" rel="noopener"{% endif %}>
                    {{ item.title }}
                  </a>
                </li>
              {% endfor %}
            </ul>
          </li>
        {% endif %}

      </ul>
    </nav>

    <!-- Mobile menu toggle -->
    <button type="button"
            class="nav-toggle"
            aria-controls="mobile-nav"
            aria-expanded="false"
            aria-label="Open navigation menu"
            data-nav-toggle>
      <span class="nav-toggle-icon" aria-hidden="true">
        <span></span><span></span><span></span>
      </span>
    </button>
  </div>

  <!-- Mobile navigation drawer -->
  <div class="mobile-nav-shell" data-nav-container>
    <div class="mobile-nav-backdrop" data-nav-overlay aria-hidden="true"></div>

    <nav id="mobile-nav" class="mobile-nav" role="navigation" aria-label="Mobile navigation">
      <div class="mobile-nav-header">
        <span class="mobile-nav-title">Menu</span>
        <button type="button" class="nav-close" data-nav-close aria-label="Close menu">
          <svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" focusable="false">
            <line x1="18" y1="6" x2="6" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <line x1="6" y1="6" x2="18" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>

      <ul class="mobile-menu">
        {% for item in nav.primary %}
          {% assign is_active = false %}
          {% if item.match and page.url %}
            {% if page.url matches item.match %}
              {% assign is_active = true %}
            {% endif %}
          {% endif %}

          <li class="mobile-nav-item{% if item.children %} has-children{% endif %}">
            {% if item.url %}
              <a href="{{ item.url | relative_url }}"
                 class="mobile-nav-link{% if is_active %} active{% endif %}"
                 {% if item.external %} target="_blank" rel="noopener"{% endif %}>
                {{ item.title }}
              </a>
            {% else %}
              <span class="mobile-nav-link mobile-nav-link--label">{{ item.title }}</span>
            {% endif %}

            {% if item.children %}
              <button class="mobile-subtoggle"
                      type="button"
                      aria-label="Open {{ item.title }} submenu"
                      aria-expanded="false"
                      data-mobile-subtoggle>
                <span aria-hidden="true">▾</span>
              </button>

              <ul class="mobile-submenu" data-mobile-submenu>
                {% for child in item.children %}
                  <li class="mobile-subitem">
                    <a href="{{ child.url | relative_url }}"
                       class="mobile-sublink"
                       {% if child.external %} target="_blank" rel="noopener"{% endif %}>
                      {{ child.title }}
                    </a>
                  </li>
                {% endfor %}
              </ul>
            {% endif %}
          </li>
        {% endfor %}
      </ul>

      <div class="mobile-nav-cta">
        <a class="btn btn--primary btn--block" href="{{ 'contact/' | relative_url }}">
          Request Estimate
        </a>
        <a class="btn btn--ghost btn--block" href="tel:+16098628808">
          Call (609) 862-8808
        </a>
      </div>
    </nav>
  </div>
</header>